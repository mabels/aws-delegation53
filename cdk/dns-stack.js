"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DNSStack = void 0;
const cdk = require("@aws-cdk/core");
const route53 = require("@aws-cdk/aws-route53");
const iam = require("@aws-cdk/aws-iam");
const aws_iam_1 = require("@aws-cdk/aws-iam");
function dnsStack(stack, props) {
    const zones = props.domains.map((d) => new route53.PublicHostedZone(stack, d, {
        zoneName: d,
    }));
    const dnsAdmin = new iam.Role(stack, props.dnsAdmin, {
        assumedBy: new iam.AccountRootPrincipal(),
        roleName: props.dnsAdmin
    });
    dnsAdmin.addToPolicy(new aws_iam_1.PolicyStatement({
        effect: iam.Effect.ALLOW,
        actions: ["route53:ChangeResourceRecordSets"],
        resources: ["arn:aws:route53:::hostedzone/*"],
    }));
    dnsAdmin.addToPolicy(new aws_iam_1.PolicyStatement({
        effect: iam.Effect.ALLOW,
        actions: ["route53:ListHostedZones", "route53:ListResourceRecordSets"],
        resources: ["*"],
    }));
    return zones;
}
class DNSStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        dnsStack(this, props);
    }
}
exports.DNSStack = DNSStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG5zLXN0YWNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZG5zLXN0YWNrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHFDQUFzQztBQUN0QyxnREFBaUQ7QUFDakQsd0NBQXlDO0FBQ3pDLDhDQUFtRDtBQVFuRCxTQUFTLFFBQVEsQ0FBRSxLQUFnQixFQUFFLEtBQWU7SUFDbEQsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUNsQyxJQUFJLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFO1FBQ3JDLFFBQVEsRUFBRSxDQUFDO0tBQ1osQ0FBQyxDQUNMLENBQUM7SUFDRixNQUFNLFFBQVEsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxRQUFRLEVBQUU7UUFDcEQsU0FBUyxFQUFFLElBQUksR0FBRyxDQUFDLG9CQUFvQixFQUFFO1FBQ3pDLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUTtLQUN4QixDQUFDLENBQUE7SUFDRixRQUFRLENBQUMsV0FBVyxDQUNsQixJQUFJLHlCQUFlLENBQUM7UUFDbEIsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSztRQUN4QixPQUFPLEVBQUUsQ0FBQyxrQ0FBa0MsQ0FBQztRQUM3QyxTQUFTLEVBQUUsQ0FBQyxnQ0FBZ0MsQ0FBQztLQUM5QyxDQUFDLENBQ0gsQ0FBQztJQUNGLFFBQVEsQ0FBQyxXQUFXLENBQ2xCLElBQUkseUJBQWUsQ0FBQztRQUNsQixNQUFNLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLO1FBQ3hCLE9BQU8sRUFBRSxDQUFDLHlCQUF5QixFQUFFLGdDQUFnQyxDQUFDO1FBQ3RFLFNBQVMsRUFBRSxDQUFDLEdBQUcsQ0FBQztLQUNqQixDQUFDLENBQ0gsQ0FBQztJQUNGLE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUdELE1BQWEsUUFBUyxTQUFRLEdBQUcsQ0FBQyxLQUFLO0lBQ3JDLFlBQVksS0FBYyxFQUFFLEVBQVUsRUFBRSxLQUFnQztRQUN0RSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN4QixRQUFRLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQ3ZCLENBQUM7Q0FDRjtBQUxELDRCQUtDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNkayA9IHJlcXVpcmUoXCJAYXdzLWNkay9jb3JlXCIpO1xuaW1wb3J0IHJvdXRlNTMgPSByZXF1aXJlKFwiQGF3cy1jZGsvYXdzLXJvdXRlNTNcIik7XG5pbXBvcnQgaWFtID0gcmVxdWlyZShcIkBhd3MtY2RrL2F3cy1pYW1cIik7XG5pbXBvcnQgeyBQb2xpY3lTdGF0ZW1lbnQgfSBmcm9tIFwiQGF3cy1jZGsvYXdzLWlhbVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEROU1Byb3BzIHtcbiAgcmVhZG9ubHkgZG5zQWRtaW46IHN0cmluZztcbiAgcmVhZG9ubHkgZG9tYWluczogc3RyaW5nW107XG59XG5cblxuZnVuY3Rpb24gZG5zU3RhY2soIHN0YWNrOiBjZGsuU3RhY2ssIHByb3BzOiBETlNQcm9wcykge1xuICBjb25zdCB6b25lcyA9IHByb3BzLmRvbWFpbnMubWFwKChkKSA9PlxuICAgICAgbmV3IHJvdXRlNTMuUHVibGljSG9zdGVkWm9uZShzdGFjaywgZCwge1xuICAgICAgICB6b25lTmFtZTogZCxcbiAgICAgIH0pXG4gICk7XG4gIGNvbnN0IGRuc0FkbWluID0gbmV3IGlhbS5Sb2xlKHN0YWNrLCBwcm9wcy5kbnNBZG1pbiwge1xuXHQgIGFzc3VtZWRCeTogbmV3IGlhbS5BY2NvdW50Um9vdFByaW5jaXBhbCgpLFxuXHQgIHJvbGVOYW1lOiBwcm9wcy5kbnNBZG1pblxuICB9KVxuICBkbnNBZG1pbi5hZGRUb1BvbGljeShcbiAgICBuZXcgUG9saWN5U3RhdGVtZW50KHtcbiAgICAgIGVmZmVjdDogaWFtLkVmZmVjdC5BTExPVyxcbiAgICAgIGFjdGlvbnM6IFtcInJvdXRlNTM6Q2hhbmdlUmVzb3VyY2VSZWNvcmRTZXRzXCJdLFxuICAgICAgcmVzb3VyY2VzOiBbXCJhcm46YXdzOnJvdXRlNTM6Ojpob3N0ZWR6b25lLypcIl0sXG4gICAgfSlcbiAgKTtcbiAgZG5zQWRtaW4uYWRkVG9Qb2xpY3koXG4gICAgbmV3IFBvbGljeVN0YXRlbWVudCh7XG4gICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuQUxMT1csXG4gICAgICBhY3Rpb25zOiBbXCJyb3V0ZTUzOkxpc3RIb3N0ZWRab25lc1wiLCBcInJvdXRlNTM6TGlzdFJlc291cmNlUmVjb3JkU2V0c1wiXSxcbiAgICAgIHJlc291cmNlczogW1wiKlwiXSxcbiAgICB9KVxuICApO1xuICByZXR1cm4gem9uZXM7XG59XG5cblxuZXhwb3J0IGNsYXNzIEROU1N0YWNrIGV4dGVuZHMgY2RrLlN0YWNrIHtcbiAgY29uc3RydWN0b3Ioc2NvcGU6IGNkay5BcHAsIGlkOiBzdHJpbmcsIHByb3BzOiBjZGsuU3RhY2tQcm9wcyAmIEROU1Byb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XG4gICAgZG5zU3RhY2sodGhpcywgcHJvcHMpXG4gIH1cbn1cbiJdfQ==